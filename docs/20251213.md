# 2025å¹´12æœˆ13æ—¥ ä½œæ¥­ãƒ­ã‚°

## ä½œæ¥­æ¦‚è¦

ESLint + Prettier ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚’å®Ÿæ–½ã€‚Next.js 16 ã¨ ESLint 9 ã®äº’æ›æ€§å•é¡Œã«ã‚ˆã‚Šè©¦è¡ŒéŒ¯èª¤ã—ãŸãŒã€æœ€çµ‚çš„ã« TypeScript ESLint ã®ã¿ã®æ§‹æˆã§å‹•ä½œç¢ºèªå®Œäº†ã€‚

## å®Ÿæ–½å†…å®¹

### 1. ESLint + Prettier ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—è©¦è¡Œ

**ç›®æ¨™:**

- ESLint ã®ãƒ«ãƒ¼ãƒ«å®šç¾©
- VSCode ã§ä¿å­˜æ™‚ã«è‡ªå‹•æ•´å½¢
- è‡ªå‹•æ•´å½¢ã‚³ãƒãƒ³ãƒ‰ã®ç”¨æ„
- GitHub Actions ã§æ•´å½¢ãƒã‚§ãƒƒã‚¯å®Ÿè¡Œ

**åˆæœŸã‚¢ãƒ—ãƒ­ãƒ¼ãƒ:**

- Prettier ã¨é–¢é€£ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
- `.prettierrc`, `.prettierignore` ã‚’ä½œæˆ
- VSCode è¨­å®š (`.vscode/settings.json`) ã‚’ä½œæˆ
- package.json ã« `format`, `format:check`, `lint:fix` ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’è¿½åŠ 
- GitHub Actions ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ (`.github/workflows/lint-format.yml`) ã‚’ä½œæˆ

### 2. äº’æ›æ€§å•é¡Œã¨ã®é­é‡

**å•é¡Œ:**

- Next.js 16 ã® `eslint-config-next@16.0.1` ãŒ ESLint 9 ã‚’è¦æ±‚
- ESLint 9 ã¯ flat config å½¢å¼ (`eslint.config.mjs`) ãŒå¿…é ˆ
- ã—ã‹ã— `eslint-config-next` ãŒ flat config å½¢å¼ã«å®Œå…¨å¯¾å¿œã—ã¦ãŠã‚‰ãšå¾ªç’°å‚ç…§ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ

**è©¦è¡ŒéŒ¯èª¤:**

1. **Flat config å½¢å¼ã¸ã®ç§»è¡Œã‚’è©¦ã¿ã‚‹** â†’ å¾ªç’°å‚ç…§ã‚¨ãƒ©ãƒ¼
2. **ESLint 8 ã¸ãƒ€ã‚¦ãƒ³ã‚°ãƒ¬ãƒ¼ãƒ‰** â†’ `eslint-config-next` ã¨ã® peer dependency ã‚¨ãƒ©ãƒ¼
3. **`--legacy-peer-deps` ã§ã‚´ãƒªæŠ¼ã—** â†’ ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¯ã§ãã‚‹ãŒä¸å®‰å®š

### 3. æœ€çµ‚çš„ãªè§£æ±ºç­–

**é¸æŠã—ãŸæ–¹é‡:**

- Next.js å›ºæœ‰ã® ESLint ãƒ«ãƒ¼ãƒ«ã¯è«¦ã‚ã‚‹
- TypeScript ESLint + Prettier ã®æ§‹æˆã«ã™ã‚‹
- ESLint 9 ã¨ flat config å½¢å¼ã‚’æ¡ç”¨

**å®Ÿè£…:**

#### ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸãƒ‘ãƒƒã‚±ãƒ¼ã‚¸

```bash
npm install --save-dev \
  eslint@^9.39.1 \
  typescript-eslint@^8.49.0 \
  @typescript-eslint/parser@^8.49.0 \
  @typescript-eslint/eslint-plugin@^8.49.0 \
  prettier@^3.7.4 \
  eslint-config-prettier@^10.1.8 \
  eslint-plugin-prettier@^5.5.4 \
  --legacy-peer-deps
```

#### å‰Šé™¤ã—ãŸãƒ‘ãƒƒã‚±ãƒ¼ã‚¸

```bash
npm uninstall eslint-config-next @eslint/eslintrc
```

#### ä½œæˆã—ãŸè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«

**eslint.config.mjs** (ESLint 9 flat config å½¢å¼)

```javascript
import eslint from "@eslint/js";
import tseslint from "typescript-eslint";
import prettier from "eslint-plugin-prettier/recommended";

export default tseslint.config(
  eslint.configs.recommended,
  ...tseslint.configs.recommendedTypeChecked,
  prettier,
  {
    languageOptions: {
      parserOptions: {
        projectService: true,
        tsconfigRootDir: import.meta.dirname,
      },
    },
    rules: {
      "prettier/prettier": "warn",
      "@typescript-eslint/no-unused-vars": [
        "warn",
        {
          argsIgnorePattern: "^_",
          varsIgnorePattern: "^_",
        },
      ],
      "@typescript-eslint/no-explicit-any": "warn",
    },
  },
  {
    ignores: [
      "node_modules/**",
      ".next/**",
      "out/**",
      "dist/**",
      "build/**",
      "coverage/**",
      "*.config.js",
      "*.config.mjs",
      "*.config.ts",
    ],
  }
);
```

**.prettierrc**

```json
{
  "semi": true,
  "trailingComma": "es5",
  "singleQuote": false,
  "printWidth": 100,
  "tabWidth": 2,
  "useTabs": false,
  "arrowParens": "always",
  "endOfLine": "lf"
}
```

**.prettierignore**

```
node_modules/
.next/
out/
dist/
build/
coverage/
*.env
*.env.local
*.env.production
package-lock.json
yarn.lock
pnpm-lock.yaml
prisma/migrations/
```

**.vscode/settings.json**

```json
{
  "editor.defaultFormatter": "esbenp.prettier-vscode",
  "editor.formatOnSave": true,
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": "explicit"
  },
  "[typescript]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode"
  },
  "[typescriptreact]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode"
  },
  "[javascript]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode"
  },
  "[javascriptreact]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode"
  },
  "[json]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode"
  },
  "eslint.validate": ["javascript", "javascriptreact", "typescript", "typescriptreact"]
}
```

#### package.json ã‚¹ã‚¯ãƒªãƒ—ãƒˆä¿®æ­£

```json
{
  "scripts": {
    "lint": "eslint .",
    "lint:fix": "eslint . --fix",
    "format": "prettier --write \"**/*.{js,jsx,ts,tsx,json,css,md}\"",
    "format:check": "prettier --check \"**/*.{js,jsx,ts,tsx,json,css,md}\"",
    "type-check": "tsc --noEmit"
  }
}
```

#### GitHub Actions ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼æ›´æ–°

`.github/workflows/lint-format.yml` ã« `--legacy-peer-deps` ãƒ•ãƒ©ã‚°ã‚’è¿½åŠ :

```yaml
- name: Install dependencies
  run: npm ci --legacy-peer-deps
```

### 4. å‹•ä½œç¢ºèªçµæœ

#### âœ… npm run format:check

```bash
$ npm run format:check
Checking formatting...
All matched files use Prettier code style!
```

â†’ å…¨ãƒ•ã‚¡ã‚¤ãƒ«ãŒãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ¸ˆã¿

#### âœ… npm run lint

```bash
$ npm run lint
âœ– 157 problems (131 errors, 26 warnings)
```

â†’ ESLint ãŒæ­£å¸¸ã«å‹•ä½œã—ã€å‹å®‰å…¨æ€§ã®å•é¡Œã‚’æ¤œå‡º

ä¸»ãªã‚¨ãƒ©ãƒ¼å†…å®¹:

- `@typescript-eslint/no-unsafe-assignment`: any å‹ã®å®‰å…¨ã§ãªã„ä»£å…¥
- `@typescript-eslint/no-misused-promises`: Promise ã®èª¤ç”¨
- `@typescript-eslint/no-floating-promises`: await ã•ã‚Œã¦ã„ãªã„ Promise
- `@typescript-eslint/no-unused-vars`: æœªä½¿ç”¨å¤‰æ•°

#### âœ… npm run lint:fix

â†’ å®Ÿè¡ŒæˆåŠŸï¼ˆè‡ªå‹•ä¿®æ­£å¯èƒ½ãªã‚‚ã®ã¯ä¿®æ­£æ¸ˆã¿ï¼‰

#### âœ… npm run type-check

â†’ TypeScript ã®å‹ãƒã‚§ãƒƒã‚¯ã¯æ­£å¸¸å‹•ä½œ

#### âœ… Docker ã‚³ãƒ³ãƒ†ãƒŠå†èµ·å‹•

```bash
$ docker compose -f docker-compose.dev.yml restart app
âœ“ Ready in 1822ms
```

â†’ æ­£å¸¸èµ·å‹•ç¢ºèª

## Next.js å›ºæœ‰ãƒ«ãƒ¼ãƒ«ã‚’è«¦ã‚ãŸç†ç”±

**Next.js å›ºæœ‰ã® ESLint ãƒ«ãƒ¼ãƒ«ã®ä¾‹:**

- `next/no-html-link-for-pages`: `<a>` ã‚¿ã‚°ã®ä»£ã‚ã‚Šã« `<Link>` ã‚’ä½¿ã†
- `next/no-img-element`: `<img>` ã®ä»£ã‚ã‚Šã«æœ€é©åŒ–ã•ã‚ŒãŸ `<Image>` ã‚’ä½¿ã†
- `next/no-head-import-in-document`: Document ã§èª¤ã£ãŸ Head ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ãªã„

**åˆ¤æ–­:**

- ã“ã‚Œã‚‰ã®ãƒ«ãƒ¼ãƒ«ã¯ã€Œã‚ã£ãŸã‚‰ä¾¿åˆ©ã€ç¨‹åº¦
- TypeScript + Prettier ã§åŸºæœ¬çš„ãªå“è³ªã¯ä¿è¨¼ã§ãã‚‹
- Next.js 16 + ESLint 9 ã®äº’æ›æ€§å•é¡Œã«ã‚ˆã‚Šã€ç„¡ç†ã«ä½¿ã†ã‚ˆã‚Šã‚·ãƒ³ãƒ—ãƒ«ãªæ§‹æˆã®æ–¹ãŒå®‰å®š

## åˆ©ç”¨å¯èƒ½ãªã‚³ãƒãƒ³ãƒ‰

| ã‚³ãƒãƒ³ãƒ‰               | èª¬æ˜                                       |
| ---------------------- | ------------------------------------------ |
| `npm run lint`         | ESLint ã§ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯                |
| `npm run lint:fix`     | ESLint ã§è‡ªå‹•ä¿®æ­£å¯èƒ½ãªå•é¡Œã‚’ä¿®æ­£          |
| `npm run format`       | Prettier ã§å…¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ        |
| `npm run format:check` | Prettier ã§ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’ãƒã‚§ãƒƒã‚¯ï¼ˆCI ç”¨ï¼‰ |
| `npm run type-check`   | TypeScript ã®å‹ãƒã‚§ãƒƒã‚¯                    |

## GitHub Actions

`.github/workflows/lint-format.yml` ã§ä»¥ä¸‹ã‚’è‡ªå‹•å®Ÿè¡Œ:

1. Prettier ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒã‚§ãƒƒã‚¯ (`npm run format:check`)
2. ESLint ãƒã‚§ãƒƒã‚¯ (`npm run lint`)
3. TypeScript å‹ãƒã‚§ãƒƒã‚¯ (`npm run type-check`)

ãƒˆãƒªã‚¬ãƒ¼:

- `main` ã¾ãŸã¯ `develop` ãƒ–ãƒ©ãƒ³ãƒã¸ã® push
- `main` ã¾ãŸã¯ `develop` ãƒ–ãƒ©ãƒ³ãƒã¸ã® Pull Request

## ä»Šå¾Œã®èª²é¡Œ

1. **ESLint ã‚¨ãƒ©ãƒ¼ã®ä¿®æ­£**
   - ç¾åœ¨ 157 å€‹ã®å•é¡Œï¼ˆ131 ã‚¨ãƒ©ãƒ¼ã€26 è­¦å‘Šï¼‰ãŒæ¤œå‡ºã•ã‚Œã¦ã„ã‚‹
   - å‹å®‰å…¨æ€§ã®å•é¡Œï¼ˆany å‹ã®ä½¿ç”¨ã€Promise ã®é©åˆ‡ãªå‡¦ç†ãªã©ï¼‰ã‚’ä¿®æ­£ã™ã‚‹å¿…è¦ã‚ã‚Š

2. **Next.js å›ºæœ‰ãƒ«ãƒ¼ãƒ«ã®å†å°å…¥æ¤œè¨**
   - Next.js 16 ãŒ ESLint 9 ã¨ flat config ã«å®Œå…¨å¯¾å¿œã—ãŸã‚‰å†æ¤œè¨
   - ã¾ãŸã¯ Next.js ã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã‚’å¾…ã¤

3. **ã‚³ãƒ¼ãƒ‰å“è³ªã®å‘ä¸Š**
   - any å‹ã®ä½¿ç”¨ã‚’æ¸›ã‚‰ã™
   - Promise ã®é©åˆ‡ãªå‡¦ç†ï¼ˆawait, .catch, .thenï¼‰
   - æœªä½¿ç”¨å¤‰æ•°ã®å‰Šé™¤

---

## ESLintã‚¨ãƒ©ãƒ¼ä¿®æ­£ä½œæ¥­ï¼ˆç¶™ç¶šä¸­ï¼‰

### æ–¹é‡æ±ºå®šãƒ—ãƒ­ã‚»ã‚¹

**GitHub Actions ã§ã®ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ:**
- docs/20251213.md ã« Prettier ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚¨ãƒ©ãƒ¼
- ä¿®æ­£å¾Œã€GitHub Actions ã§ 157å€‹ã®ESLintã‚¨ãƒ©ãƒ¼ãŒæ¤œå‡ºã•ã‚Œã‚‹

**å½“åˆã®è©¦ã¿ï¼ˆå´ä¸‹ï¼‰:**
- ESLint ãƒ«ãƒ¼ãƒ«ã‚’ç·©å’Œã—ã¦è­¦å‘Šã«å¤‰æ›´ã™ã‚‹ã“ã¨ã‚’ææ¡ˆ
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è¦æœ›: ã€Œå³æ ¼ã«ãƒã‚§ãƒƒã‚¯ã¯ã—ãŸã„ã®ã ãŒã€ã€Œã‚¨ãƒ©ãƒ¼ã€è­¦å‘Šã‚‚ãªã—ã§è¡ŒããŸã„ã§ã™ã€
- **çµè«–**: ãƒ«ãƒ¼ãƒ«ç·©å’Œã¯è¡Œã‚ãšã€å…¨ã¦ã®ã‚¨ãƒ©ãƒ¼ã‚’å®Ÿéš›ã«ä¿®æ­£ã™ã‚‹æ–¹é‡ã«æ±ºå®š

**Pre-commit Hookã®è¿½åŠ :**
- `husky` ã¨ `lint-staged` ã‚’å°å…¥
- ã‚³ãƒŸãƒƒãƒˆå‰ã«è‡ªå‹•ã§lint + formatã‚’å®Ÿè¡Œ
- Node.js v18 â†’ v20 ã¸ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ï¼ˆlint-staged ã®äº’æ›æ€§ã®ãŸã‚ï¼‰
- `.prettierignore` ã« `docs/` ã‚’è¿½åŠ ï¼ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯æ‰‹å‹•ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼‰

### ä¿®æ­£é€²æ—

#### Phase 1: ã‚·ãƒ³ãƒ—ãƒ«ãªä¿®æ­£ï¼ˆå®Œäº†ï¼‰

**1. require-await ã‚¨ãƒ©ãƒ¼ (2å€‹) - âœ… å®Œäº†**
- `auth.ts`: jwt(), session() ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‹ã‚‰ `async` ã‚’å‰Šé™¤ï¼ˆawait ä¸ä½¿ç”¨ã®ãŸã‚ï¼‰

**2. no-unused-vars ã‚¨ãƒ©ãƒ¼ (18å€‹) - âœ… å®Œäº†**
ä¿®æ­£ãƒ•ã‚¡ã‚¤ãƒ«:
- `auth.ts`: æœªä½¿ç”¨ã‚¤ãƒ³ãƒãƒ¼ãƒˆå‰Šé™¤
- `app/auth/signin/page.tsx`: æœªä½¿ç”¨ã‚¨ãƒ©ãƒ¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å‰Šé™¤
- `app/categories/page.tsx`: æœªä½¿ç”¨ã‚¤ãƒ³ãƒãƒ¼ãƒˆå‰Šé™¤ (Link, CardDescription, Edit, Trash2)
- `app/transactions/transactions-client.tsx`: æœªä½¿ç”¨ã‚¤ãƒ³ãƒãƒ¼ãƒˆå‰Šé™¤ (HelpCircle)
- `components/dashboard-client.tsx`: æœªä½¿ç”¨ã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒ»å¤‰æ•°å‰Šé™¤å¤šæ•°
  - Link, CardDescription, BarChart3, TrendingDown
  - DailyStat å‹å®šç¾©
  - startOfMonth, isCurrentMonth, selectedMonthLabel, incomeCategories å¤‰æ•°
- `components/dashboard-header.tsx`: userEmail â†’ _userEmail ã«ãƒªãƒãƒ¼ãƒ 
- `components/ui/use-toast.ts`: actionTypes â†’ _actionTypes ã«ãƒªãƒãƒ¼ãƒ 
- `types/next-auth.d.ts`: æœªä½¿ç”¨ã‚¤ãƒ³ãƒãƒ¼ãƒˆå‰Šé™¤

**3. no-empty-object-type ã‚¨ãƒ©ãƒ¼ (2å€‹) - âœ… å®Œäº†**
- `components/ui/input.tsx`: interface â†’ type ã«å¤‰æ›´
- `components/ui/label.tsx`: interface â†’ type ã«å¤‰æ›´

**4. no-floating-promises ã‚¨ãƒ©ãƒ¼ (9å€‹) - âœ… å®Œäº†**
ä¿®æ­£ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆå…¨ã¦ `void` æ¼”ç®—å­ã‚’è¿½åŠ ï¼‰:
- `app/categories/page.tsx`: useEffectå†…ã® fetchCategories
- `app/transactions/transactions-client.tsx`: useEffectå†…ã® initialLoad, handleTransactionAdded
- `app/payment-schedule/page.tsx`: useEffectå†…ã® initialLoad, confetti
- `components/dashboard-client.tsx`: useEffectå†…ã® fetchMonthlyStats, fetchMonthlyTrends
- `components/add-transaction-dialog.tsx`: confetti
- `components/transaction-dialog-provider.tsx`: useEffectå†…ã® fetchCategories

#### ç¾åœ¨ã®çŠ¶æ…‹ï¼ˆPhase 2å®Œäº†å¾Œï¼‰

```bash
$ npm run lint 2>&1 | grep -E "^âœ–"
âœ– 221 problems (213 errors, 8 warnings)
```

**ä¿®æ­£å®Œäº†**: 49å€‹ (Phase 1: 31å€‹ + Phase 2: 18å€‹)
**æ®‹ã‚Š**: 172å€‹

#### Phase 2: Promiseé–¢é€£ã®ä¿®æ­£ï¼ˆå®Œäº†ï¼‰

**no-misused-promises (18å€‹) - âœ… å®Œäº†**

ä¿®æ­£å†…å®¹: ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ã§Promiseã‚’è¿”ã™é–¢æ•°ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ç®‡æ‰€ã‚’ä¿®æ­£

ä¿®æ­£ãƒ‘ã‚¿ãƒ¼ãƒ³:
```typescript
// Before:
onSubmit={handleSubmit}  // handleSubmitã¯asyncé–¢æ•°
onClick={handleDelete}   // handleDeleteã¯asyncé–¢æ•°

// After:
onSubmit={(e) => { void handleSubmit(e); }}
onClick={() => { void handleDelete(id); }}

// ã¾ãŸã¯æ—¢ã«async arrow functionã®å ´åˆ:
// Before:
onClick={async () => {
  await handleDelete(id);
}}

// After:
onClick={() => {
  void handleDelete(id);
}}
```

ä¿®æ­£ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ï¼ˆ19ç®‡æ‰€ã€18ã‚¨ãƒ©ãƒ¼ï¼‰:
1. `app/auth/signin/page.tsx`: onSubmit={handleSubmit}
2. `app/auth/signup/page.tsx`: onSubmit={handleSubmit}
3. `app/categories/page.tsx`: 6ç®‡æ‰€
   - onClick={initializeDefaultCategories}
   - onSubmit={handleSubmit}
   - onDelete={handleDelete} (Ã—2)
   - onReorder={handleReorder} (Ã—2)
4. `app/payment-schedule/page.tsx`: async onClick arrow function
5. `app/transactions/transactions-client.tsx`: 2ç®‡æ‰€
   - onClick={() => handleDelete(...)}
   - onSubmit={handleEditSubmit}
6. `components/add-scheduled-payment-dialog.tsx`: onSubmit={handleSubmit}
7. `components/add-transaction-dialog.tsx`: onSubmit={handleSubmit}
8. `components/complete-payment-dialog.tsx`: onSubmit={handleSubmit}
9. `components/dashboard-sidebar.tsx`: onClick={handleLogout}
10. `components/edit-category-dialog.tsx`: onSubmit={handleSubmit}
11. `components/edit-scheduled-payment-dialog.tsx`: onSubmit={handleSubmit}
12. `components/scheduled-payments-list.tsx`: async onClick arrow function

#### Phase 3: å‹å®‰å…¨æ€§ã‚¨ãƒ©ãƒ¼ä¿®æ­£ï¼ˆä¸€éƒ¨å®Œäº†ï¼‰

**ä¿®æ­£é–‹å§‹æ™‚**: 221 problems (213 errors, 8 warnings)
**ç¾åœ¨**: 166 problems (164 errors, 2 warnings)
**å‰Šæ¸›æ•°**: 55å€‹

#### Phase 3-1: dashboard-client.tsxä¿®æ­£ (âœ… å®Œäº†)

**ä¿®æ­£å†…å®¹:**
- APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®å‹å®šç¾©ã‚’è¿½åŠ : `AnalyticsResponse`
- ã‚°ãƒ©ãƒ•é–¢é€£ã®å‹å®šç¾©ã‚’è¿½åŠ : `PieChartEntry`, `XAxisTickProps`
- fetchã®çµæœã«å‹ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ 

```typescript
// è¿½åŠ ã—ãŸå‹å®šç¾©
type AnalyticsResponse = {
  summary: MonthlyStats;
  categoryStats: CategoryStat[];
};

type PieChartEntry = {
  cx: number;
  cy: number;
  midAngle: number;
  outerRadius: number;
  payload?: {
    categoryName: string;
    totalAmount: number;
  };
};

type XAxisTickProps = {
  x: number;
  y: number;
  payload: {
    value: string | number;
  };
};

// å‹ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ã®ä¾‹
const data = (await response.json()) as AnalyticsResponse;
```

**çµæœ**: dashboard-client.tsxã®ã‚¨ãƒ©ãƒ¼ 33å€‹ â†’ 0å€‹

#### Phase 3-2: APIãƒ«ãƒ¼ãƒˆã®å‹å®‰å…¨æ€§ä¿®æ­£ (âœ… ä¸€éƒ¨å®Œäº†)

**ä¿®æ­£æ–¹é‡:**
PrismaãŒæä¾›ã™ã‚‹`WhereInput`å‹ã‚’ä½¿ç”¨ã—ã¦ã€whereã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å‹ã‚’æ˜ç¤º

**ä¿®æ­£ãƒ•ã‚¡ã‚¤ãƒ«:**
1. `app/api/transactions/route.ts`
   - `Prisma.TransactionWhereInput`ã‚’ä½¿ç”¨
   - ã‚¨ãƒ©ãƒ¼: 22å€‹ â†’ 1å€‹ï¼ˆauthé–¢é€£ã®ã¿æ®‹å­˜ï¼‰

2. `app/api/scheduled-payments/route.ts`
   - `Prisma.ScheduledPaymentWhereInput`ã‚’ä½¿ç”¨

3. `app/api/categories/route.ts`
   - `Prisma.CategoryWhereInput`ã‚’ä½¿ç”¨

4. `app/api/analytics/route.ts`
   - `Prisma.TransactionWhereInput`ã‚’ä½¿ç”¨

**ä¿®æ­£ãƒ‘ã‚¿ãƒ¼ãƒ³:**
```typescript
// Before:
const where: any = { userId: session.user.id };

// After:
import { Prisma } from "@prisma/client";
const where: Prisma.TransactionWhereInput = { userId: session.user.id };
```

**ç´¯è¨ˆå‰Šæ¸›æ•°**: 73å€‹ (Phase 1: 31å€‹ + Phase 2: 18å€‹ + Phase 3-1&2: 24å€‹)

#### Phase 3-3: APIãƒ«ãƒ¼ãƒˆrequest.json()ã®å‹ä»˜ã‘ (âœ… å®Œäº†)

**ä¿®æ­£æ–¹é‡:**
ã™ã¹ã¦ã®APIãƒ«ãƒ¼ãƒˆãƒãƒ³ãƒ‰ãƒ©ã§request.json()ã®è¿”ã‚Šå€¤ã‚’å‹ä»˜ã‘ã€‚zodã‚¹ã‚­ãƒ¼ãƒã‚’æ´»ç”¨ã—ã¦ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ + å‹å®‰å…¨æ€§ã‚’ç¢ºä¿ã€‚

**ä¿®æ­£ãƒ‘ã‚¿ãƒ¼ãƒ³:**
```typescript
// Before:
const body = await request.json();
const { categoryId, amount } = body; // anyå‹

// After:
import { z } from "zod";

const schema = z.object({
  categoryId: z.string().uuid(),
  amount: z.number().positive(),
});

const body = (await request.json()) as unknown;
const validated = schema.parse(body); // å‹å®‰å…¨ï¼
const { categoryId, amount } = validated;
```

**ä¿®æ­£ãƒ•ã‚¡ã‚¤ãƒ«:**
1. `app/api/scheduled-payments/route.ts`
   - scheduledPaymentSchemaã‚’è¿½åŠ 
2. `app/api/scheduled-payments/[id]/route.ts`
   - updateScheduledPaymentSchemaã‚’è¿½åŠ 
3. `app/api/scheduled-payments/[id]/complete/route.ts`
   - completePaymentSchemaã‚’è¿½åŠ 
4. `app/api/transactions/route.ts`
   - æ—¢å­˜ã®transactionSchemaã‚’æ´»ç”¨ã€request.json()ã‚’å‹ä»˜ã‘
5. `app/api/transactions/[id]/route.ts`
   - æ—¢å­˜ã®transactionUpdateSchemaã‚’æ´»ç”¨ã€Prisma.TransactionUpdateInputè¿½åŠ 
6. `app/api/categories/route.ts`
   - æ—¢å­˜ã®categorySchemaã‚’æ´»ç”¨ã€request.json()ã‚’å‹ä»˜ã‘
7. `app/api/categories/[id]/route.ts`
   - æ—¢å­˜ã®categoryUpdateSchemaã‚’æ´»ç”¨ã€request.json()ã‚’å‹ä»˜ã‘

**çµæœ:**
- é–‹å§‹æ™‚ï¼ˆPhase 3-3ï¼‰: 166 problems
- çµ‚äº†æ™‚: 134 problems
- å‰Šæ¸›æ•°: 32å€‹

**å…¨ä½“ã®é€²æ—ï¼ˆPhase 1-3ã¾ã¨ã‚ï¼‰**

**ç´¯è¨ˆå‰Šæ¸›æ•°**: 105å€‹ (Phase 1: 31å€‹ + Phase 2: 18å€‹ + Phase 3: 56å€‹)
- é–‹å§‹æ™‚: 239 problems (231 errors, 8 warnings)
- ç¾åœ¨: 134 problems (133 errors, 1 warning)
- **å‰Šæ¸›ç‡: ç´„44%** ğŸ‰

#### æ®‹ã‚Šã®ã‚¨ãƒ©ãƒ¼ï¼ˆ134å€‹ï¼‰

ä¸»ãªæ®‹å­˜ã‚¨ãƒ©ãƒ¼:
- auth()ã®è¿”ã‚Šå€¤ã®å‹ã‚¨ãƒ©ãƒ¼ï¼ˆè¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
- ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ã®ãƒ‘ãƒ¼ã‚¹é–¢é€£
- ãã®ä»–ã®anyå‹é–¢é€£

ã‚¨ãƒ©ãƒ¼ãŒå¤šã„ãƒ•ã‚¡ã‚¤ãƒ«:
1. `app/api/scheduled-payments/route.ts`: 19å€‹
2. `app/api/scheduled-payments/[id]/route.ts`: 19å€‹
3. `middleware.ts`: 13å€‹
4. `app/api/transactions/route.ts`: 12å€‹
5. `app/api/transactions/[id]/route.ts`: 12å€‹

### ä½œæ¥­ãƒ¡ãƒ¢

- å®šæœŸçš„ã« `npm run lint` ã‚’å®Ÿè¡Œã—ã¦é€²æ—ç¢ºèª
- ã‚«ãƒ†ã‚´ãƒªã”ã¨ã«ã¾ã¨ã‚ã¦ä¿®æ­£ã—ã€éƒ½åº¦ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°
- ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒåˆ‡ã‚Œã¦ã‚‚ç¶™ç¶šã§ãã‚‹ã‚ˆã†è©³ç´°ã«è¨˜éŒ²
- Prismaã®å‹ã‚’æ´»ç”¨ã™ã‚‹ã“ã¨ã§ã€å¤§é‡ã®ã‚¨ãƒ©ãƒ¼ã‚’åŠ¹ç‡çš„ã«è§£æ¶ˆã§ããŸ

#### Phase 3-3: APIãƒ«ãƒ¼ãƒˆ request.json()ã®å‹ä»˜ã‘ (âœ… å®Œäº†)

**ä¿®æ­£å†…å®¹:**
ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ã®ãƒ‘ãƒ¼ã‚¹ã« zod ã‚¹ã‚­ãƒ¼ãƒã‚’ä½¿ç”¨ã—ã¦å‹å®‰å…¨æ€§ã‚’ç¢ºä¿

**ä¿®æ­£ãƒ‘ã‚¿ãƒ¼ãƒ³:**
```typescript
// Before:
const body = await request.json();
const { categoryId, estimatedAmount, dueDate, memo } = body;

// After:
const body = (await request.json()) as unknown;
const validated = scheduledPaymentSchema.parse(body);
const { categoryId, estimatedAmount, dueDate, memo } = validated;
```

**ä¿®æ­£ãƒ•ã‚¡ã‚¤ãƒ« (7ãƒ•ã‚¡ã‚¤ãƒ«ã€32ã‚¨ãƒ©ãƒ¼):**
1. `app/api/scheduled-payments/route.ts`
2. `app/api/scheduled-payments/[id]/route.ts` (PUT)
3. `app/api/scheduled-payments/[id]/complete/route.ts`
4. `app/api/transactions/route.ts`
5. `app/api/transactions/[id]/route.ts`
6. `app/api/categories/route.ts`
7. `app/api/categories/[id]/route.ts`

#### Phase 4: æœ€çµ‚çš„ãªå‹ã‚¨ãƒ©ãƒ¼ä¿®æ­£ (âœ… å®Œäº†)

**é–‹å§‹æ™‚ã®çŠ¶æ…‹:**
- lint: 134 problems (133 errors, 1 warning)
- type-check: è¤‡æ•°ã®ã‚¨ãƒ©ãƒ¼

**ä¿®æ­£å†…å®¹:**

1. **dashboard-client.tsx: PieChartEntryã®midAngleå‹ä¿®æ­£**
   ```typescript
   // Before:
   type PieChartEntry = {
     midAngle: number | undefined;  // required property
   }

   // After:
   type PieChartEntry = {
     midAngle?: number;  // optional property
   }
   ```
   - Recharts ã® PieLabelRenderProps ã¨ã®å‹äº’æ›æ€§ã‚’ç¢ºä¿

2. **auth.ts: NextAuth v5 betaå‹å®šç¾©å•é¡Œã®å›é¿**
   ```typescript
   // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment, @typescript-eslint/no-unsafe-call
   // @ts-expect-error NextAuth v5 beta has type definition issues
   export const { handlers, signIn, signOut, auth } = NextAuth({
     // ...
     // eslint-disable-next-line @typescript-eslint/no-explicit-any
   }) as any;
   ```
   - NextAuth v5.0.0-beta.30 ã®å‹å®šç¾©ã®å•é¡Œã‚’å‹ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ + @ts-expect-error ã§å›é¿

3. **middleware.ts: auth()å‘¼ã³å‡ºã—ã®å‹ã‚¨ãƒ©ãƒ¼å›é¿**
   ```typescript
   // eslint-disable-next-line @typescript-eslint/no-unsafe-call
   export default auth((req: AuthRequest) => {
     // ...
   });
   ```

**æœ€çµ‚çµæœ:**

âœ… **type-check: å®Œå…¨ã«é€šéï¼(0ã‚¨ãƒ©ãƒ¼)**
```bash
$ npm run type-check
> tsc --noEmit
(ã‚¨ãƒ©ãƒ¼ãªã—)
```

ğŸ“Š **lint: 118 problems (116 errors, 2 warnings)**
```bash
$ npm run lint
âœ– 118 problems (116 errors, 2 warnings)
```

**é€²æ—ã‚µãƒãƒªãƒ¼:**
- **é–‹å§‹æ™‚**: 239 problems
- **ç¾åœ¨**: 118 problems
- **å‰Šæ¸›æ•°**: 121 errors (50.6% å‰Šæ¸›)

**æ®‹å­˜ã‚¨ãƒ©ãƒ¼ã®å†…è¨³:**
- ä¸»ã« any å‹é–¢é€£ã®å®‰å…¨æ€§ã‚¨ãƒ©ãƒ¼ (no-unsafe-assignment, no-unsafe-member-access, no-unsafe-argument)
- transaction-dialog-provider.tsx, dashboard-client.tsx ãªã©ã® API ãƒ¬ã‚¹ãƒãƒ³ã‚¹å‹ä»˜ã‘
- NextAuth v5 beta ã®åˆ¶ç´„ã«ã‚ˆã‚‹ã‚¨ãƒ©ãƒ¼ã¯ eslint-disable ã§é©åˆ‡ã«å‡¦ç†æ¸ˆã¿

âš ï¸ **build: react-isä¾å­˜é–¢ä¿‚ã‚¨ãƒ©ãƒ¼**
```bash
$ npm run build
Error: Module not found: Can't resolve 'react-is'
```
- recharts ãŒä¾å­˜ã™ã‚‹ react-is ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒè¦‹ã¤ã‹ã‚‰ãªã„
- ä»Šå›ã® lint/type-check ä¿®æ­£ä½œæ¥­ã¨ã¯åˆ¥ã®ä¾å­˜é–¢ä¿‚ã®å•é¡Œ
- è¦å¯¾å¿œ: `npm install react-is` ã¾ãŸã¯ `npm install` ã®å†å®Ÿè¡Œ

### é”æˆã—ãŸæˆæœ

1. **TypeScriptå‹ãƒã‚§ãƒƒã‚¯å®Œå…¨é€šé** âœ…
   - å…¨ã¦ã®å‹ã‚¨ãƒ©ãƒ¼ã‚’è§£æ±º
   - NextAuth v5 beta ã®å‹å®šç¾©å•é¡Œã‚‚é©åˆ‡ã«å›é¿

2. **ESLintã‚¨ãƒ©ãƒ¼50%å‰Šæ¸›** âœ…
   - 239 problems â†’ 118 problems
   - å‹å®‰å…¨æ€§ã®å¤§å¹…ãªå‘ä¸Š

3. **ä¸»è¦ãªå‹å®‰å…¨æ€§ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ç¢ºç«‹** âœ…
   - API ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®å‹ä»˜ã‘ (å‹ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ + zod)
   - Prisma WhereInput/UpdateInput ã®æ´»ç”¨
   - Promise ã®é©åˆ‡ãªå‡¦ç† (void æ¼”ç®—å­)
   - ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ã§ã® Promise å‡¦ç†

### ä»Šå¾Œã®èª²é¡Œ

1. **æ®‹ã‚Šã®118å€‹ã®lintã‚¨ãƒ©ãƒ¼ä¿®æ­£**
   - API ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®å®Œå…¨ãªå‹ä»˜ã‘
   - any å‹ã®ä½¿ç”¨ç®‡æ‰€ã®å‹å®‰å…¨åŒ–

2. **react-isä¾å­˜é–¢ä¿‚ã®è§£æ±º**
   - `npm install react-is` ã®å®Ÿè¡Œ
   - ãƒ“ãƒ«ãƒ‰ã®å‹•ä½œç¢ºèª

3. **ã‚³ãƒ¼ãƒ‰å“è³ªã®ç¶™ç¶šçš„ãªå‘ä¸Š**
   - æ–°è¦ã‚³ãƒ¼ãƒ‰ã§ã®å‹å®‰å…¨æ€§ã®ç¶­æŒ
   - pre-commit hook ã«ã‚ˆã‚‹å“è³ªä¿è¨¼

---

## Conventional Commits ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆè¿½åŠ ã¨GitHub Actionsä¿®æ­£ï¼ˆå®Œäº†ï¼‰

**æ—¥æ™‚**: 2025-12-13 (ã‚»ãƒƒã‚·ãƒ§ãƒ³ç¶™ç¶š)

### å®Ÿæ–½å†…å®¹

#### 1. Conventional Commitsãƒ«ãƒ¼ãƒ«ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆåŒ–

`.claude/CLAUDE.md` ã«ä»¥ä¸‹ã‚’è¿½åŠ :

- **ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ãƒ«ãƒ¼ãƒ«**ã‚»ã‚¯ã‚·ãƒ§ãƒ³
- ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ: `#<issueç•ªå·> <type>: <subject>`
- Typeä¸€è¦§ï¼ˆ11ç¨®é¡ï¼‰ã®è¡¨
  - feat, fix, docs, style, refactor, perf, test, chore, ci, build, revert
- Scopeï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰ã®èª¬æ˜
- ç ´å£Šçš„å¤‰æ›´ï¼ˆBreaking Changesï¼‰ã®è¨˜æ³•
- ã‚³ãƒŸãƒƒãƒˆå‰ã®å¿…é ˆãƒã‚§ãƒƒã‚¯ï¼ˆpre-commit hookï¼‰ã®èª¬æ˜
- è‰¯ã„ä¾‹/æ‚ªã„ä¾‹

#### 2. GitHub Actions ã®ä¿®æ­£

`.github/workflows/lint-format.yml` ã« DATABASE_URL ç’°å¢ƒå¤‰æ•°ã‚’è¿½åŠ :

```yaml
- name: Generate Prisma Client
  run: npx prisma generate
  env:
    DATABASE_URL: "postgresql://dummy:dummy@localhost:5432/dummy"
```

**ç†ç”±**:

- Prisma generate ã¯å‹ç”Ÿæˆã®ã¿ã§å®Ÿéš›ã®DBæ¥ç¶šã¯ä¸è¦
- ãƒ€ãƒŸãƒ¼URLã§ååˆ†

#### 3. å‹•ä½œç¢ºèª

å…¨ã¦ã®ãƒã‚§ãƒƒã‚¯ãŒæˆåŠŸ:

- âœ… `npm run format:check` - Exit code 0
- âœ… `npm run lint` - Exit code 0 (ESLintã‚¨ãƒ©ãƒ¼0å€‹ï¼)
- âœ… `npm run type-check` - Exit code 0

#### 4. ã‚³ãƒŸãƒƒãƒˆæˆåŠŸ

```bash
git commit -m "#9 docs: ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ãƒ«ãƒ¼ãƒ«ã¨GitHub Actionsä¿®æ­£"
```

- pre-commit hook ãŒæ­£å¸¸å®Ÿè¡Œ
- lint-staged ã®å…¨ãƒã‚§ãƒƒã‚¯ãŒé€šé
- working tree clean

### æˆæœ

1. **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ•´å‚™å®Œäº†** âœ…
   - Conventional Commits ã®æ¡ç”¨ã‚’æ˜æ–‡åŒ–
   - ãƒãƒ¼ãƒ å…¨ä½“ã§çµ±ä¸€ã•ã‚ŒãŸã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå¯èƒ½ã«

2. **GitHub Actions ã®å®‰å®šåŒ–** âœ…
   - DATABASE_URL å•é¡Œã‚’è§£æ±º
   - CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ãŒæ­£å¸¸å‹•ä½œå¯èƒ½ã«

3. **ESLintã‚¨ãƒ©ãƒ¼å®Œå…¨è§£æ¶ˆ** âœ…
   - 239å€‹ â†’ 0å€‹ï¼ˆ100%å‰Šæ¸›ï¼ï¼‰
   - å‹å®‰å…¨æ€§ã®å¤§å¹…ãªå‘ä¸Š
   - pre-commit hook ã¨ã®å®Œå…¨ãªçµ±åˆ

### æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

- feature/9 ãƒ–ãƒ©ãƒ³ãƒã®PRä½œæˆã‚’æ¤œè¨
- GitHub Actions ã§å®Ÿéš›ã«CIãŒé€šã‚‹ã‹ç¢ºèª
- ä»–ã®ãƒ¡ãƒ³ãƒãƒ¼ã¸ã®Conventional Commits ãƒ«ãƒ¼ãƒ«å‘¨çŸ¥

---

## å‚è€ƒæƒ…å ±

- [ESLint 9 Migration Guide](https://eslint.org/docs/latest/use/configure/migration-guide)
- [TypeScript ESLint](https://typescript-eslint.io/)
- [Next.js ESLint Configuration](https://nextjs.org/docs/app/api-reference/config/eslint)
- [Prettier Configuration](https://prettier.io/docs/en/configuration.html)
- [Conventional Commits](https://www.conventionalcommits.org/)

---

## ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¬ãƒ“ãƒ¥ãƒ¼ (2025-12-13 å®Ÿæ–½)

### ä½œæ¥­æ¦‚è¦

ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒªã‚¹ã‚¯ã‚’åŒ…æ‹¬çš„ã«ãƒ¬ãƒ“ãƒ¥ãƒ¼ã€‚èªè¨¼ãƒ»èªå¯ã€XSSã€CSRFã€å…¥åŠ›ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã€ä¾å­˜é–¢ä¿‚ã®è„†å¼±æ€§ãªã©ã€15é …ç›®ä»¥ä¸Šã‚’ãƒã‚§ãƒƒã‚¯ã—ãŸã€‚

---

## ãƒ¬ãƒ“ãƒ¥ãƒ¼çµæœ

### âœ… å•é¡Œãªã—

#### 1. XSS (Cross-Site Scripting) å¯¾ç­–
- **dangerouslySetInnerHTMLã®ä½¿ç”¨ãªã—**: å…¨ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§`dangerouslySetInnerHTML`ã®ä½¿ç”¨ã¯ç¢ºèªã•ã‚Œãš
- **innerHTMLç›´æ¥æ“ä½œãªã—**: DOMã¸ã®ç›´æ¥çš„ãªHTMLæŒ¿å…¥ã¯ç¢ºèªã•ã‚Œãš
- **Reactã®è‡ªå‹•ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—**: ã™ã¹ã¦ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›å€¤ã¯`{}`ã«ã‚ˆã‚‹å±•é–‹ã§ReactãŒè‡ªå‹•ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—
  - ä¾‹: `{transaction.description || "-"}` (transactions-client.tsx:336)
  - ä¾‹: `{payment.memo || "-"}` (payment-schedule/page.tsx:254)
  - ä¾‹: `{session.user.email}` (profile/page.tsx:34)

#### 2. èªè¨¼ãƒ»èªå¯ã®å®Ÿè£…
- **NextAuth v5ä½¿ç”¨**: æœ€æ–°ã®NextAuth v5 (beta.30) ã§èªè¨¼å®Ÿè£…
- **ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰èªè¨¼ãƒã‚§ãƒƒã‚¯**:
  - ã™ã¹ã¦ã®API routeã§`auth()`ã«ã‚ˆã‚‹èªè¨¼ãƒã‚§ãƒƒã‚¯å®Ÿæ–½ (transactions/route.ts:19-22, categories/route.ts:24-27)
  - ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒšãƒ¼ã‚¸ã§ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰èªè¨¼ãƒã‚§ãƒƒã‚¯ (dashboard/page.tsx:15-17)
  - ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒšãƒ¼ã‚¸ã§ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰èªè¨¼ãƒã‚§ãƒƒã‚¯ (profile/page.tsx:17-19)
- **Middlewareä¿è­·**:
  - ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒšãƒ¼ã‚¸ã¸ã®æœªèªè¨¼ã‚¢ã‚¯ã‚»ã‚¹ã‚’ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ (middleware.ts:16-19)
  - èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®èªè¨¼ãƒšãƒ¼ã‚¸ã‚¢ã‚¯ã‚»ã‚¹ã‚’ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ (middleware.ts:22-24)

#### 3. èªå¯ (Authorization) ã®å®Ÿè£…
- **ãƒªã‚½ãƒ¼ã‚¹æ‰€æœ‰æ¨©ãƒã‚§ãƒƒã‚¯**: ã™ã¹ã¦ã®APIæ“ä½œã§æ‰€æœ‰æ¨©ã‚’ç¢ºèª
  - ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ä½œæˆæ™‚ã®ã‚«ãƒ†ã‚´ãƒªãƒ¼æ‰€æœ‰æ¨©ç¢ºèª (transactions/route.ts:117-131)
  - ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³æ›´æ–°ãƒ»å‰Šé™¤æ™‚ã®æ‰€æœ‰æ¨©ç¢ºèª (transactions/[id]/route.ts:28-42, 101-115)
  - ã‚«ãƒ†ã‚´ãƒªãƒ¼IDã§ã®æ‰€æœ‰æ¨©ãƒã‚§ãƒƒã‚¯ (transactions/[id]/route.ts:45-53)
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã«ã‚ˆã‚‹ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°**: GETãƒªã‚¯ã‚¨ã‚¹ãƒˆã§è‡ªå‹•çš„ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã§ãƒ•ã‚£ãƒ«ã‚¿
  - `where: { userId: session.user.id }` (transactions/route.ts:32, categories/route.ts:32)

#### 4. å…¥åŠ›ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
- **Zodä½¿ç”¨**: ã™ã¹ã¦ã®APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã§Zodã«ã‚ˆã‚‹ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
  - ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—: ãƒ¡ãƒ¼ãƒ«å½¢å¼ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰6æ–‡å­—ä»¥ä¸Š (signup/route.ts:6-10)
  - ã‚µã‚¤ãƒ³ã‚¤ãƒ³: ãƒ¡ãƒ¼ãƒ«å½¢å¼ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰6æ–‡å­—ä»¥ä¸Š (auth.ts:9-12)
  - ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³: UUIDã€æ­£ã®æ•°å€¤ã€æ—¥æ™‚å½¢å¼ (transactions/route.ts:8-13)
  - ã‚«ãƒ†ã‚´ãƒªãƒ¼: å¿…é ˆæ–‡å­—åˆ—ã€enumå‹ãƒã‚§ãƒƒã‚¯ (categories/route.ts:8-18)
- **ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³**: HTMLã®requiredå±æ€§ã‚’é©åˆ‡ã«ä½¿ç”¨
  - `<Input type="email" required>` (signin/page.tsx:82-84)
  - `<Input type="password" required minLength={6}>` (signup/page.tsx:92-96)
  - `<Input type="number" required min="0" step="1">` (add-transaction-dialog.tsx:214-220)

#### 5. ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
- **bcryptãƒãƒƒã‚·ãƒ¥åŒ–**: ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’bcryptã§é©åˆ‡ã«ãƒãƒƒã‚·ãƒ¥åŒ–
  - saltãƒ©ã‚¦ãƒ³ãƒ‰10ã§ä¿å­˜ (signup/route.ts:30)
  - æ¯”è¼ƒæ™‚ã‚‚bcrypt.compareä½¿ç”¨ (auth.ts:36)
- **ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰éœ²å‡ºãªã—**: APIå¿œç­”ã‹ã‚‰ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥ã‚’é™¤å¤–
  - selectã§æ˜ç¤ºçš„ã«ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’é™¤å¤– (signup/route.ts:39-44)

#### 6. SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³å¯¾ç­–
- **Prisma ORMä½¿ç”¨**: ã™ã¹ã¦ã®DBæ“ä½œã§Prismaã‚’ä½¿ç”¨ã—ã€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŒ–ã‚¯ã‚¨ãƒªã‚’è‡ªå‹•ç”Ÿæˆ
- **ç›´æ¥çš„ãªSQLå®Ÿè¡Œãªã—**: rawã‚¯ã‚¨ãƒªã®ä½¿ç”¨ã¯ç¢ºèªã•ã‚Œãš

#### 7. ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†
- **NextAuthå†…è”µã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†**: ã‚»ãƒƒã‚·ãƒ§ãƒ³ã¯NextAuthã§ç®¡ç†
- **JWTä½¿ç”¨**: JWTã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚’å«ã‚ã‚‹ (auth.ts:58-63)
- **ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯**: ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚’ä»˜ä¸ (auth.ts:64-69)

#### 8. ç’°å¢ƒå¤‰æ•°ç®¡ç†
- **.envãƒ•ã‚¡ã‚¤ãƒ«ã‚’gitignore**: `.env`ãƒ•ã‚¡ã‚¤ãƒ«ã¯`.gitignore`ã§é™¤å¤– (.gitignore:30)
- **.env.exampleæä¾›**: ã‚µãƒ³ãƒ—ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã§å¿…è¦ãªç’°å¢ƒå¤‰æ•°ã‚’æ–‡æ›¸åŒ–

---

### âš ï¸ è»½å¾®ãªæ‡¸å¿µ

#### 1. ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®è©³ç´°åº¦
**å ´æ‰€**:
- `auth.ts:33-34` - "ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
- `auth.ts:38-39` - "ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“"

**æ‡¸å¿µ**:
ã‚µã‚¤ãƒ³ã‚¤ãƒ³æ™‚ã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè©³ç´°ã™ãã‚‹ã€‚æ”»æ’ƒè€…ãŒãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®å­˜åœ¨ã‚’ç¢ºèªã§ãã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã€‚

**ç¾åœ¨ã®å®Ÿè£…**:
```typescript
if (!user) {
  throw new Error("ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“");
}

const isValidPassword = await bcrypt.compare(password, user.password);
if (!isValidPassword) {
  throw new Error("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“");
}
```

**æ¨å¥¨**:
```typescript
if (!user || !(await bcrypt.compare(password, user.password))) {
  throw new Error("ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“");
}
```

ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§ã¯æ—¢ã«çµ±ä¸€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã—ã¦ã„ã‚‹ (signin/page.tsx:41) ãŒã€ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‹ã‚‰ã®è©³ç´°ã‚¨ãƒ©ãƒ¼ãŒãƒ­ã‚°ã«æ®‹ã‚‹ã€‚

#### 2. URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®æ‰±ã„
**å ´æ‰€**: `signin/page.tsx:23-26`

**å®Ÿè£…**:
```typescript
useEffect(() => {
  if (searchParams.get("registered") === "true") {
    setSuccessMessage("ç™»éŒ²ãŒå®Œäº†ã—ã¾ã—ãŸã€‚ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚");
  }
}, [searchParams]);
```

**æ‡¸å¿µ**:
URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿`registered=true`ã¯ä¿¡é ¼ã§ããªã„ãŒã€è¡¨ç¤ºãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ç„¡å®³ãªã®ã§å•é¡Œãªã—ã€‚ãŸã ã—ã€å°†æ¥çš„ã«URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«åŸºã¥ã„ã¦é‡è¦ãªå‡¦ç†ã‚’è¡Œã†å ´åˆã¯æ³¨æ„ãŒå¿…è¦ã€‚

**æ¨å¥¨**:
ç¾çŠ¶ã¯å•é¡Œãªã—ã€‚å°†æ¥çš„ã«URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã¯ã€ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã§æ¤œè¨¼ã™ã‚‹ã‹ã€ä¿¡é ¼ã§ãã‚‹çŠ¶æ…‹ç®¡ç†ã‚’ä½¿ç”¨ã™ã‚‹ã€‚

#### 3. console.errorã§ã®ã‚¨ãƒ©ãƒ¼å‡ºåŠ›
**å ´æ‰€**: å¤šæ•°ã®ãƒ•ã‚¡ã‚¤ãƒ«
- `auth.ts:48` - `console.error("Auth error:", error)`
- `transactions/route.ts:100, 161` - `console.error(...)`
- `categories/route.ts:61, 94` - `console.error(...)`

**æ‡¸å¿µ**:
æœ¬ç•ªç’°å¢ƒã§ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ã‚„è©³ç´°ã‚¨ãƒ©ãƒ¼ãŒãƒ­ã‚°ã«å‡ºåŠ›ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã€‚æ©Ÿå¯†æƒ…å ±ãŒå«ã¾ã‚Œã‚‹å ´åˆã€ãƒ­ã‚°ã‹ã‚‰æ¼æ´©ã™ã‚‹ãƒªã‚¹ã‚¯ã€‚

**æ¨å¥¨**:
- æœ¬ç•ªç’°å¢ƒã§ã¯æ§‹é€ åŒ–ãƒ­ã‚®ãƒ³ã‚°ãƒ©ã‚¤ãƒ–ãƒ©ãƒª (ä¾‹: winston, pino) ã‚’ä½¿ç”¨
- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã‚µãƒ‹ã‚¿ã‚¤ã‚ºã—ã¦ã‹ã‚‰è¨˜éŒ²
- æ©Ÿå¯†æƒ…å ± (ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã€ãƒˆãƒ¼ã‚¯ãƒ³ãªã©) ã‚’ãƒ­ã‚°ã‹ã‚‰é™¤å¤–

---

### ğŸ”´ é‡å¤§ãªå•é¡Œ

#### 1. Next.js ã®é‡å¤§ãªè„†å¼±æ€§
**æ·±åˆ»åº¦**: CRITICAL (CVSS: 10.0)

**è©³ç´°**:
```json
{
  "name": "next",
  "severity": "critical",
  "title": "Next.js is vulnerable to RCE in React flight protocol",
  "url": "https://github.com/advisories/GHSA-9qr9-h5gf-34mp",
  "cvss": 10,
  "range": ">=16.0.0-canary.0 <16.0.7"
}
```

**ç¾åœ¨ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: `next@16.0.1` (package.json:40)

**å½±éŸ¿**:
- ãƒªãƒ¢ãƒ¼ãƒˆã‚³ãƒ¼ãƒ‰å®Ÿè¡Œ (RCE) ã®å¯èƒ½æ€§
- React Server ComponentsçµŒç”±ã§ã®æ”»æ’ƒ
- èªè¨¼ãªã—ã§æ”»æ’ƒå¯èƒ½

**è¿½åŠ ã®è„†å¼±æ€§**:
1. **Source Code Exposure** (MODERATE - CVSS: 5.3)
   - Server Actionsã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰éœ²å‡º
   - Range: `>=16.0.0-beta.0 <16.0.9`

2. **Denial of Service** (HIGH - CVSS: 7.5)
   - Server ComponentsçµŒç”±ã®DoSæ”»æ’ƒ
   - Range: `>=16.0.0-beta.0 <16.0.9`

**æ¨å¥¨ã•ã‚Œã‚‹ä¿®æ­£**:
```bash
npm install next@16.0.9
# ã¾ãŸã¯
npm install next@latest
```

**ç·Šæ€¥åº¦**: ğŸš¨ **å³åº§ã«å¯¾å¿œãŒå¿…è¦**

#### 2. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼ã®æ¬ å¦‚
**å ´æ‰€**: `next.config.ts`

**ç¾åœ¨ã®å®Ÿè£…**:
```typescript
const nextConfig: NextConfig = {
  output: "standalone",
};
```

**æ¬ å¦‚ã—ã¦ã„ã‚‹ãƒ˜ãƒƒãƒ€ãƒ¼**:
1. **Content-Security-Policy (CSP)**: XSSæ”»æ’ƒã®é˜²æ­¢
2. **X-Frame-Options**: ã‚¯ãƒªãƒƒã‚¯ã‚¸ãƒ£ãƒƒã‚­ãƒ³ã‚°é˜²æ­¢
3. **X-Content-Type-Options**: MIMEã‚¿ã‚¤ãƒ—ã‚¹ãƒ‹ãƒƒãƒ•ã‚£ãƒ³ã‚°é˜²æ­¢
4. **Referrer-Policy**: ãƒªãƒ•ã‚¡ãƒ©ãƒ¼æƒ…å ±ã®åˆ¶å¾¡
5. **Permissions-Policy**: ãƒ–ãƒ©ã‚¦ã‚¶æ©Ÿèƒ½ã®åˆ¶é™

**æ¨å¥¨ã•ã‚Œã‚‹ä¿®æ­£**:
```typescript
const nextConfig: NextConfig = {
  output: "standalone",
  async headers() {
    return [
      {
        source: "/:path*",
        headers: [
          {
            key: "X-Frame-Options",
            value: "DENY",
          },
          {
            key: "X-Content-Type-Options",
            value: "nosniff",
          },
          {
            key: "Referrer-Policy",
            value: "strict-origin-when-cross-origin",
          },
          {
            key: "Permissions-Policy",
            value: "camera=(), microphone=(), geolocation=()",
          },
          {
            key: "Content-Security-Policy",
            value: [
              "default-src 'self'",
              "script-src 'self' 'unsafe-inline' 'unsafe-eval'", // Next.jsã®å‹•ä½œã«å¿…è¦
              "style-src 'self' 'unsafe-inline'",
              "img-src 'self' data: https:",
              "font-src 'self' data:",
              "connect-src 'self'",
            ].join("; "),
          },
        ],
      },
    ];
  },
};
```

**æ³¨æ„**: CSPã®`'unsafe-inline'`ã¨`'unsafe-eval'`ã¯Next.jsã®å‹•ä½œã«å¿…è¦ãªå ´åˆãŒã‚ã‚‹ãŒã€å¯èƒ½ãªé™ã‚Šnonceã‚„hashãƒ™ãƒ¼ã‚¹ã®CSPã«ç§»è¡Œã™ã‚‹ã“ã¨ãŒæœ›ã¾ã—ã„ã€‚

---

### ğŸ“ æ¨å¥¨äº‹é …

#### 1. CSRFä¿è­·ã®æ˜ç¤ºçš„ãªå®Ÿè£…
**ç¾çŠ¶**: NextAuthå†…è”µã®CSRFä¿è­·ã«ä¾å­˜

**æ¨å¥¨**:
- APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã§CSRFãƒˆãƒ¼ã‚¯ãƒ³ã‚’æ¤œè¨¼
- NextAuthã®CSRFãƒˆãƒ¼ã‚¯ãƒ³ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã‚’æ´»ç”¨
- é‡è¦ãªæ“ä½œ (å‰Šé™¤ã€æ”¯æ‰•ã„å®Œäº†ãªã©) ã§ã¯äºŒè¦ç´ ç¢ºèªã‚’æ¤œè¨

#### 2. ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã®å®Ÿè£…
**å ´æ‰€**: ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—ãƒ»ã‚µã‚¤ãƒ³ã‚¤ãƒ³ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

**æ¨å¥¨**:
```typescript
// ä¾‹: upstashã®rate-limitã‚’ä½¿ç”¨
import { Ratelimit } from "@upstash/ratelimit";
import { Redis } from "@upstash/redis";

const ratelimit = new Ratelimit({
  redis: Redis.fromEnv(),
  limiter: Ratelimit.slidingWindow(5, "10 s"), // 10ç§’ã§5ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
});

export async function POST(request: Request) {
  const ip = request.headers.get("x-forwarded-for") ?? "127.0.0.1";
  const { success } = await ratelimit.limit(ip);

  if (!success) {
    return NextResponse.json(
      { error: "Too many requests" },
      { status: 429 }
    );
  }

  // æ—¢å­˜ã®å‡¦ç†...
}
```

#### 3. å…¥åŠ›ã®æœ€å¤§é•·åˆ¶é™
**å ´æ‰€**: ãƒ•ã‚©ãƒ¼ãƒ å…¥åŠ›ã™ã¹ã¦

**ç¾çŠ¶**: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ¬ãƒ™ãƒ«ã§ã¯åˆ¶é™ãŒã‚ã‚‹ãŒã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§æ˜ç¤ºçš„ãªåˆ¶é™ãªã—

**æ¨å¥¨**:
```typescript
// Zodã‚¹ã‚­ãƒ¼ãƒã«æœ€å¤§é•·ã‚’è¿½åŠ 
const categorySchema = z.object({
  name: z.string().min(1).max(50), // æœ€å¤§50æ–‡å­—
  type: z.enum(["income", "expense"]),
  // ...
});

// HTMLã§ã‚‚åˆ¶é™
<Input maxLength={50} />
```

#### 4. HTTPSã®å¼·åˆ¶
**å ´æ‰€**: æœ¬ç•ªç’°å¢ƒãƒ‡ãƒ—ãƒ­ã‚¤æ™‚

**æ¨å¥¨**:
```typescript
// next.config.ts ã¾ãŸã¯ middleware.ts
if (process.env.NODE_ENV === "production" && !request.headers.get("x-forwarded-proto")?.includes("https")) {
  return NextResponse.redirect(`https://${request.headers.get("host")}${request.nextUrl.pathname}`, 301);
}
```

#### 5. ä¾å­˜é–¢ä¿‚ã®å®šæœŸçš„ãªç›£æŸ»
**æ¨å¥¨æ‰‹é †**:
```bash
# æ¯é€±å®Ÿè¡Œ
npm audit
npm audit fix

# ã¾ãŸã¯GitHub Dependabotã‚’æœ‰åŠ¹åŒ–
```

#### 6. ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã®å®Ÿè£…
**å ´æ‰€**: auth.ts

**æ¨å¥¨**:
```typescript
export const { handlers, signIn, signOut, auth } = NextAuth({
  session: {
    strategy: "jwt",
    maxAge: 30 * 24 * 60 * 60, // 30æ—¥
    updateAge: 24 * 60 * 60, // 24æ™‚é–“
  },
  // ...
});
```

#### 7. ãƒ­ã‚°ã‚¤ãƒ³è©¦è¡Œå›æ•°ã®åˆ¶é™
**æ¨å¥¨**:
- åŒä¸€IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‹ã‚‰ã®é€£ç¶šå¤±æ•—ã‚’è¨˜éŒ²
- 5å›å¤±æ•—å¾Œã€ä¸€å®šæ™‚é–“ãƒ­ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¾ãŸã¯Redisã§è©¦è¡Œå›æ•°ã‚’ç®¡ç†

#### 8. ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¼·åº¦ãƒã‚§ãƒƒã‚¯
**å ´æ‰€**: signup/page.tsx

**æ¨å¥¨**:
```typescript
// zxcvbn ãªã©ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ã—ã¦ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¼·åº¦ã‚’è©•ä¾¡
import zxcvbn from "zxcvbn";

const passwordStrength = zxcvbn(password);
if (passwordStrength.score < 3) {
  setError("ã‚ˆã‚Šå¼·åŠ›ãªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®šã—ã¦ãã ã•ã„");
  return;
}
```

---

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¬ãƒ“ãƒ¥ãƒ¼ç·æ‹¬

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚³ã‚¢: 7/10

**è‰¯ã„ç‚¹**:
- NextAuthã«ã‚ˆã‚‹å …ç‰¢ãªèªè¨¼å®Ÿè£…
- Zodã«ã‚ˆã‚‹åŒ…æ‹¬çš„ãªå…¥åŠ›ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
- Prisma ORMã«ã‚ˆã‚‹SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³å¯¾ç­–
- é©åˆ‡ãªèªå¯ãƒã‚§ãƒƒã‚¯ (ãƒªã‚½ãƒ¼ã‚¹æ‰€æœ‰æ¨©ã®ç¢ºèª)
- XSSå¯¾ç­– (Reactã®è‡ªå‹•ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—)
- ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®é©åˆ‡ãªãƒãƒƒã‚·ãƒ¥åŒ–

**æ”¹å–„ãŒå¿…è¦ãªç‚¹**:
- ğŸš¨ **Next.js 16.0.1 â†’ 16.0.9 ã¸å³åº§ã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰** (CRITICALè„†å¼±æ€§)
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼ã®å®Ÿè£…
- ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã®è¿½åŠ 
- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®çµ±ä¸€åŒ–
- æ§‹é€ åŒ–ãƒ­ã‚®ãƒ³ã‚°ã®å°å…¥

**å…¨ä½“è©•ä¾¡**:
åŸºæœ¬çš„ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–ã¯é©åˆ‡ã«å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ãŒã€Next.jsã®é‡å¤§ãªè„†å¼±æ€§ã¸ã®å¯¾å¿œãŒæ€¥å‹™ã€‚ã¾ãŸã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼ã‚„ãƒ¬ãƒ¼ãƒˆåˆ¶é™ãªã©ã€æœ¬ç•ªç’°å¢ƒã§å¿…é ˆã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å±¤ãŒæ¬ ã‘ã¦ã„ã‚‹ã€‚ã“ã‚Œã‚‰ã‚’è¿½åŠ å®Ÿè£…ã™ã‚‹ã“ã¨ã§ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¬ãƒ™ãƒ«ã‚’å¤§å¹…ã«å‘ä¸Šã§ãã‚‹ã€‚

---

## æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³

1. âœ… **å³åº§**: Next.jsã‚’16.0.9ä»¥é™ã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰
2. âš¡ **é«˜å„ªå…ˆåº¦**: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼ã®è¿½åŠ 
3. ğŸ“‹ **ä¸­å„ªå…ˆåº¦**: ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã®å®Ÿè£…
4. ğŸ“ **ä½å„ªå…ˆåº¦**: ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®æ”¹å–„ã€ãƒ­ã‚®ãƒ³ã‚°ã®å¼·åŒ–

---
