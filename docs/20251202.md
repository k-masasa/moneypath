# 2025/12/02 ä½œæ¥­ãƒ­ã‚°

## å®Ÿè£…å†…å®¹

### 1. å‹ã‚¨ãƒ©ãƒ¼ä¿®æ­£ - `name`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å‰Šé™¤ã«ä¼´ã†ä¿®æ­£

#### èƒŒæ™¯

å‰å›ã®ä½œæ¥­ã§`scheduled_payments`ãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰`name`ã‚«ãƒ©ãƒ ã‚’å‰Šé™¤ã—ã€ä»£ã‚ã‚Šã«`memo`ã‚«ãƒ©ãƒ ã‚’è¿½åŠ ã—ã¾ã—ãŸã€‚ã—ã‹ã—ã€ä¸€éƒ¨ã®ãƒ•ã‚¡ã‚¤ãƒ«ã§`name`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¸ã®å‚ç…§ãŒæ®‹ã£ã¦ãŠã‚Šã€å‹ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¦ã„ã¾ã—ãŸã€‚

#### ä¿®æ­£å†…å®¹

**1. app/api/scheduled-payments/[id]/complete/route.ts**

- `scheduledPayment`å–å¾—æ™‚ã«`category`ã‚’include
- ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã®descriptionã‚’`scheduledPayment.name`ã‹ã‚‰`scheduledPayment.memo || scheduledPayment.category.name`ã«å¤‰æ›´

```typescript
// Before
const scheduledPayment = await prisma.scheduledPayment.findFirst({
  where: { id, userId: session.user.id },
});

description: scheduledPayment.name,

// After
const scheduledPayment = await prisma.scheduledPayment.findFirst({
  where: { id, userId: session.user.id },
  include: { category: true },
});

description: scheduledPayment.memo || scheduledPayment.category.name,
```

**2. components/complete-payment-dialog.tsx**

- å‹å®šç¾©ã‚’ä¿®æ­£ï¼š`name`ã‚’å‰Šé™¤ã€`memo`ã¨`category`ã‚’è¿½åŠ 
- UIè¡¨ç¤ºã‚’ã€Œæ”¯æ‰•ã„åã€ã‹ã‚‰ã€Œã‚«ãƒ†ã‚´ãƒªã€ï¼‹ã€Œãƒ¡ãƒ¢ï¼ˆä»»æ„ï¼‰ã€ã«å¤‰æ›´

```typescript
// Before
scheduledPayment: {
  id: string;
  name: string;
  estimatedAmount: number;
}

// After
scheduledPayment: {
  id: string;
  estimatedAmount: number;
  memo?: string | null;
  category: {
    name: string;
  };
}
```

#### ãƒã‚§ãƒƒã‚¯å®Œäº†

- âœ… type-checkæˆåŠŸ

---

### 2. æ”¯æ‰•ã„äºˆå®šç·¨é›†æ©Ÿèƒ½ã®å®Ÿè£…

#### ç›®çš„

ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã€Œæ”¯æ‰•ã„äºˆå®šãƒ‡ãƒ¼ã‚¿ã®ç·¨é›†ã‚‚ã§ãã‚‹ã‚ˆã†ã«ã—ãŸã„ã€ã¨ã„ã†ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ã‘ã€ç·¨é›†æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¾ã—ãŸã€‚

#### å®Ÿè£…æ‰‹é †

**1. ç·¨é›†ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆä½œæˆ**

æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«: `components/edit-scheduled-payment-dialog.tsx`

**æ©Ÿèƒ½**:

- ã‚«ãƒ†ã‚´ãƒªãƒ¼é¸æŠï¼ˆæ”¯å‡ºã‚«ãƒ†ã‚´ãƒªãƒ¼ã®ã¿ï¼‰
- äºˆå®šé‡‘é¡å…¥åŠ›
- æœŸé™æ—¥ä»˜å…¥åŠ›
- ãƒ¡ãƒ¢å…¥åŠ›ï¼ˆä»»æ„ï¼‰

**å‹å®šç¾©**:

```typescript
type ScheduledPayment = {
  id: string;
  estimatedAmount: number;
  dueDate: string;
  memo?: string | null;
  categoryId: string;
};
```

**ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³**:

- ã‚«ãƒ†ã‚´ãƒªãƒ¼ã€é‡‘é¡ã€æœŸé™ã¯å¿…é ˆ
- é‡‘é¡ã¯æ­£ã®æ•°å€¤ã®ã¿

**2. æ›´æ–°APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå®Ÿè£…**

ãƒ•ã‚¡ã‚¤ãƒ«: `app/api/scheduled-payments/[id]/route.ts`

**è¿½åŠ ãƒ¡ã‚½ãƒƒãƒ‰**: `PUT`

**æ©Ÿèƒ½**:

- æ”¯æ‰•ã„äºˆå®šã®å­˜åœ¨ç¢ºèªã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼æ‰€æœ‰ç¢ºèª
- å®Œäº†æ¸ˆã¿ï¼ˆstatus = "completed"ï¼‰ã®æ”¯æ‰•ã„äºˆå®šã¯ç·¨é›†ä¸å¯
- ã‚«ãƒ†ã‚´ãƒªãƒ¼ã®å­˜åœ¨ç¢ºèª
- ã‚«ãƒ†ã‚´ãƒªã‹ã‚‰`isPublicBurden`ãƒ•ãƒ©ã‚°ã‚’è‡ªå‹•æ¤œå‡º
- ãƒ‡ãƒ¼ã‚¿æ›´æ–°

**APIä»•æ§˜**:

```typescript
PUT /api/scheduled-payments/[id]

Request: {
  categoryId: string;
  estimatedAmount: number;
  dueDate: string; // ISO date
  memo?: string | null;
}

Response: {
  scheduledPayment: ScheduledPayment & { category: Category };
}
```

**3. æ”¯æ‰•ã„äºˆå®šä¸€è¦§ãƒšãƒ¼ã‚¸ã¸ã®çµ±åˆ**

ãƒ•ã‚¡ã‚¤ãƒ«: `app/payment-schedule/page.tsx`

**å¤‰æ›´å†…å®¹**:

- `Edit`ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
- `EditScheduledPaymentDialog`ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
- `editingPayment`ã‚¹ãƒ†ãƒ¼ãƒˆã‚’è¿½åŠ 
- ãƒ†ãƒ¼ãƒ–ãƒ«ã®ã€Œæ“ä½œã€åˆ—ã«ç·¨é›†ãƒœã‚¿ãƒ³ã‚’è¿½åŠ ï¼ˆé‰›ç­†ã‚¢ã‚¤ã‚³ãƒ³ï¼‰
- ç·¨é›†ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’ãƒšãƒ¼ã‚¸æœ€å¾Œã«è¿½åŠ 
- `ScheduledPayment`å‹ã«`categoryId`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’è¿½åŠ 

**ãƒœã‚¿ãƒ³é…ç½®**:

```
[æ”¯æ‰•ã†] [ğŸ–Šï¸ç·¨é›†] [ğŸ—‘ï¸å‰Šé™¤]
```

#### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

- âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ãƒã‚§ãƒƒã‚¯
- âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼æ‰€æœ‰æ¨©ãƒã‚§ãƒƒã‚¯
- âœ… å®Œäº†æ¸ˆã¿æ”¯æ‰•ã„äºˆå®šã¯ç·¨é›†ä¸å¯
- âœ… ã‚«ãƒ†ã‚´ãƒªãƒ¼æ‰€æœ‰æ¨©ãƒã‚§ãƒƒã‚¯

#### UI/UX

- ç·¨é›†ãƒœã‚¿ãƒ³ã¯é‰›ç­†ã‚¢ã‚¤ã‚³ãƒ³ï¼ˆEditã‚¢ã‚¤ã‚³ãƒ³ï¼‰
- ã‚´ãƒ¼ã‚¹ãƒˆãƒœã‚¿ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«ã§æ§ãˆã‚ã«è¡¨ç¤º
- ã‚¯ãƒªãƒƒã‚¯ã§ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ãŒé–‹ãã€ç¾åœ¨ã®å€¤ãŒãƒ•ã‚©ãƒ¼ãƒ ã«ã‚»ãƒƒãƒˆ
- æœŸé™ã¯`YYYY-MM-DD`å½¢å¼ã«å¤‰æ›ã—ã¦è¡¨ç¤º

---

## ãƒã‚§ãƒƒã‚¯å®Œäº†

### å‹ãƒã‚§ãƒƒã‚¯

```bash
npm run type-check
```

âœ… æˆåŠŸ - å‹ã‚¨ãƒ©ãƒ¼ãªã—

### ãƒ“ãƒ«ãƒ‰ãƒã‚§ãƒƒã‚¯

```bash
npm run build
```

âœ… æˆåŠŸ - æœ€é©åŒ–ãƒ“ãƒ«ãƒ‰å®Œäº†

### Lintãƒã‚§ãƒƒã‚¯

```bash
npm run lint
```

âš ï¸ æ—¢å­˜ã®ç’°å¢ƒå•é¡Œã«ã‚ˆã‚Šå®Ÿè¡Œä¸å¯ï¼ˆ"Invalid project directory provided, no such directory: .../lint"ï¼‰
â€» æ—¢å­˜ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®šã®å•é¡Œã§ã€ä»Šå›ã®å®Ÿè£…ã¨ã¯ç„¡é–¢ä¿‚

### Dockerã‚³ãƒ³ãƒ†ãƒŠ

```bash
docker compose -f docker-compose.dev.yml restart app
```

âœ… æˆåŠŸ - é–‹ç™ºã‚µãƒ¼ãƒãƒ¼æ­£å¸¸èµ·å‹•ï¼ˆhttp://localhost:3000ï¼‰

---

## å®Ÿè£…ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«

### æ–°è¦ä½œæˆ

- âœ… `components/edit-scheduled-payment-dialog.tsx` - æ”¯æ‰•ã„äºˆå®šç·¨é›†ãƒ€ã‚¤ã‚¢ãƒ­ã‚°

### å¤‰æ›´

- âœ… `app/api/scheduled-payments/[id]/complete/route.ts` - `name`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å‚ç…§ã‚’ä¿®æ­£
- âœ… `app/api/scheduled-payments/[id]/route.ts` - PUTãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¿½åŠ 
- âœ… `components/complete-payment-dialog.tsx` - å‹å®šç¾©ã¨UIè¡¨ç¤ºã‚’ä¿®æ­£
- âœ… `app/payment-schedule/page.tsx` - ç·¨é›†æ©Ÿèƒ½ã‚’çµ±åˆ

---

## å®Œäº†å†…å®¹

### å‹ã‚¨ãƒ©ãƒ¼ä¿®æ­£

- âœ… `name`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¸ã®å‚ç…§ã‚’ã™ã¹ã¦å‰Šé™¤
- âœ… `memo`ã¨`category.name`ã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã«ä¿®æ­£
- âœ… å‹ãƒã‚§ãƒƒã‚¯æˆåŠŸ

### æ”¯æ‰•ã„äºˆå®šç·¨é›†æ©Ÿèƒ½

- âœ… ç·¨é›†ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆä½œæˆ
- âœ… æ›´æ–°APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå®Ÿè£…ï¼ˆPUT /api/scheduled-payments/[id]ï¼‰
- âœ… æ”¯æ‰•ã„äºˆå®šä¸€è¦§ãƒšãƒ¼ã‚¸ã«ç·¨é›†ãƒœã‚¿ãƒ³è¿½åŠ 
- âœ… ã‚«ãƒ†ã‚´ãƒªãƒ¼ã€é‡‘é¡ã€æœŸé™ã€ãƒ¡ãƒ¢ã‚’ç·¨é›†å¯èƒ½
- âœ… å®Œäº†æ¸ˆã¿æ”¯æ‰•ã„äºˆå®šã¯ç·¨é›†ä¸å¯åˆ¶é™
- âœ… ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯å®Ÿè£…æ¸ˆã¿
- âœ… type-check/buildæˆåŠŸ

---

## æ¬¡å›ã‚¿ã‚¹ã‚¯

- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚ˆã‚‹å‹•ä½œç¢ºèªï¼ˆç·¨é›†æ©Ÿèƒ½ï¼‰
- å¿…è¦ã«å¿œã˜ã¦UI/UXèª¿æ•´
